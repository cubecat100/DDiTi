<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>

<div class="content-header">
	<div class="d-flex align-items-center">
		<div class="me-auto">
			<!-- 현재 메뉴명 --><h3 class="page-title">상담 예약</h3>
			<div class="d-inline-block align-items-center">
				<nav>
					<ol class="breadcrumb">
						<!-- 홈아이콘 --><li class="breadcrumb-item"><a href="#"><i class="mdi mdi-home-outline"></i></a></li>
						<!-- 상위메뉴명 --><li class="breadcrumb-item" aria-current="page">상담</li>
						<!-- 하위메뉴명(현재메뉴명) --><li class="breadcrumb-item active" aria-current="page">상담 예약</li>
					</ol>
				</nav>
			</div>
		</div>

	</div>
</div>

<section class="content m-10">

<div class="row col-12">
<div class="row" style="justify-content: flex-end;">
	<div class="col-md-4"> <!-- col-md-5: 부모 너비 값의 절반 사용 -->
		<div class="form-group">
			<select class="form-control" style="width: 30%; display: inline-block;">
				<option selected="selected" disabled="disabled">전체</option> <!-- disabled : 선택안됨(select의 제목?) -->
				<option>이름</option>
				<option>학과</option>
				<option>어쩌구</option>
			</select> 
			<input type="text" placeholder="입력하세요" class="form-control" style="width: 55%; display: inline-block;">
			<button type="button" class="btn btn-primary btn-sm">검색</button>
		</div>
	</div>
</div>
  <div class="table-responsive mb-15">
	<table class="table">
		<thead class="bg-primary">
			<tr>
				<th>#</th>
				<th>이름</th>
				<th>분류</th>
				<th>학과</th>
				<th>연락처</th>
				<th>이메일</th>
				<th>상담</th>
			</tr>
		</thead>
		<tbody>
			<!-- <tr>
				<td>1</td>
				<td>Nigam</td>
				<td>Eichmann</td>
				<td>@Sonu</td>
				<td>@Sonu</td>
			</tr> -->
			<c:choose>
				<c:when test="${empty counselorList }">
					<tr>
						<td colspan="5">상담 가능한 목록이 없습니다</td>
					</tr>
				</c:when>
				<c:otherwise>
				<c:forEach items="${counselorList }" var="counselor">
					<tr>
						<td>1</td>
						<td>${counselor.memName }</td>
						<td>
							<c:if test="${counselor.memRole eq 'ROL002' }">교수</c:if>
							<c:if test="${counselor.memRole eq 'ROL003' }">교직원</c:if>
						</td>
						<td>(학과)</td>
						<td>${counselor.memPh }</td>
						<td>${counselor.memEmail }</td>
						<td>
							<button class="btn btn-primary counselBtn" idx="${counselor.memNo }" name="${counselor.memName }" >상담 >></button>
						</td>
					</tr>
				</c:forEach>
				
				</c:otherwise>
				
			</c:choose>
		</tbody>
	</table>
	  <div class="col-sm-12 col-md-7"
		style="float: right; margin-right: 100px">
		<div class="dataTables_paginate paging_simple_numbers"
			id="example1_paginate">
			<ul class="pagination">
				<li class="paginate_button page-item previous disabled"
					id="example1_previous"><a href="#" aria-controls="example1"
					data-dt-idx="0" tabindex="0" class="page-link">Previous</a></li>
				<li class="paginate_button page-item active"><a href="#"
					aria-controls="example1" data-dt-idx="1" tabindex="0"
					class="page-link">1</a></li>
				<li class="paginate_button page-item"><a href="#"
					aria-controls="example1" data-dt-idx="2" tabindex="0"
					class="page-link">2</a></li>
				<li class="paginate_button page-item"><a href="#"
					aria-controls="example1" data-dt-idx="3" tabindex="0"
					class="page-link">3</a></li>
				<li class="paginate_button page-item"><a href="#"
					aria-controls="example1" data-dt-idx="4" tabindex="0"
					class="page-link">4</a></li>
				<li class="paginate_button page-item"><a href="#"
					aria-controls="example1" data-dt-idx="5" tabindex="0"
					class="page-link">5</a></li>
				<li class="paginate_button page-item next" id="example1_next"><a
					href="#" aria-controls="example1" data-dt-idx="6" tabindex="0"
					class="page-link">Next</a></li>
			</ul>
		</div>
	</div>
  </div>
</div>

<div class="col-12 m-30"></div>

<div class="row col-12" id="reserveDateForm">

	<!-- 캘린더 -->
	<div id="calendar" class="fc fc-unthemed fc-ltr col-8 mx-h-400">
	</div>
	
	<div class="col-4">
	  <div class="box">
		<!-- /.box-header -->
		<form class="form">
			<div class="box-body">
				<h4 class="box-title text-info mb-0"><i class="ti-user me-15"></i> 상담 신청 폼</h4>
				<hr class="my-15">
				<div class="row">
				  <div class="col-md-6">
					<div class="form-group">
					  <label class="form-label">상담자 이름</label>
					  <input type="text" class="form-control" placeholder="상담자" readonly="readonly" id="memName2" name="memName2">
					</div>
				  </div>
				  <div class="col-md-6">
					<div class="form-group">
					  <label class="form-label">신청자</label>
					  <input type="text" class="form-control" placeholder="신청자" readonly="readonly" id="memName1" name="memName1">
					</div>
				  </div>
				</div>
				<div class="row">
				  <div class="col-md-6">
					<div class="form-group">
					  <label class="form-label">상담 일자</label>
					  <input type="text" class="form-control" placeholder="상담 일자" readonly="readonly" id="counselDate" name="">
					</div>
				  </div>
				  <div class="col-md-6">
					<div class="form-group">
					  <label class="form-label">시간</label>
					  <input type="text" class="form-control" placeholder="시간" readonly="readonly" id="counselTime" name="">
					</div>
				  </div>
				</div>
				<div class="row">
				  <div class="col-md-12">
					<div class="form-group">
					  <label class="form-label">상담 형식</label>
					  <select class="form-select" id="cnslType" name="cnslType">
						<option>--</option>
						<option value="">대면 상담</option>
						<option value="">비대면 채팅</option>
						<option value="">비대면 화상</option>
					  </select>
					</div>
				  </div>
				</div>
				<div class="form-group">
				  <label class="form-label">상담 신청 내용</label>
				  <textarea rows="5" class="form-control" placeholder="상담하고 싶은 내용" id="cnslReason" name="cnslReason"></textarea>
				</div>
			</div>
			<input type="hidden" id="" name="" >
			<!-- /.box-body -->
			<div class="box-footer">
				<button type="button" class="btn btn-warning me-1" onclick="f_formClear()">
				  <i class="ti-trash"></i> Cancel
				</button>
				<button type="submit" class="btn btn-primary">
				  <i class="ti-save-alt"></i> Save
				</button>
			</div>  
		</form>
	  </div>
	</div>
</div>
</section>

<script src="${pageContext.request.contextPath}/resources/js/chat.js"></script>
<script>

var calendarSelectType = false;
var counselorList = "${counselorList }";

function f_dateSelectEvent(info){
	console.log("select :",info);
}
function f_dateClickEvent(info){
	alert("t2");
}

$(function() {
	var reserveDateForm = $("#reserveDateForm");
	
	var counselBtn = $(".counselBtn");
	
	$("#memName1").val("김고양이");
	
	counselBtn.on("click", function() {
		var memNo = $(this).attr("idx");
		var memName = $(this).attr("name");
		$("#memName2").val(memName);
		
		data = {
				"memNo" : memNo
		}

		$.ajax({
			type : 'post',
			url : '/counsel/getSchData.do',
			contentType : "application/json; charset=utf-8",
			data : JSON.stringify(data),
			success : function(res) { // 결과 성공 콜백함수       
				console.log(res);
			 	
			 	if(res == null || res == ""){
			 		alert("상담 가능 시간이 없습니다...");
			 		return;
			 	}
			 	
			 	calendarSettingObj.events = res;
			 	console.log("test");
			 	
			 	var calendarEl = document.getElementById('calendar');
				
				var calendar = new FullCalendar.Calendar(calendarEl, calendarSettingObj);
			 	
				calendar.render();
			}
		})
	})
})

function f_dateClick(info){
	/* if(confirm("remove?")){
		$('#calendar').fullCalendar( 'removeEvents', calEvent.id);
	} */
	
	var st = calEvent.start._d.toLocaleString('en', { timeZone: 'UTC' });
 	var sd = dateFormat(new Date(st));
	//console.log(sd);
	
	var et = calEvent.end._d.toLocaleString('en', { timeZone: 'UTC' });
 	var ed = dateFormat(new Date(et));
	
	if(calEvent.className == 'bg-info'){
		// 상담 신청 폼에 데이터 추가
		$("#counselDate").val(sd.substring(0,10));
		$("#counselTime").val(sd.substring(11,16) + "~" + ed.substring(11,16));
	}
}

function f_formClear() {
	//모든 이벤트 삭제
	$('#calendar').fullCalendar('removeEvents');
	$("#memName2").val("");
	$("#counselDate").val("");
	$("#counselTime").val("");
	$("#cnslReason").val("");
	
	$("#cnslType").val("--");
}
</script>